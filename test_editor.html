<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆåŒ–ç¼–è¾‘å™¨æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        textarea {
            width: 100%;
            height: 150px;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .game-status {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ä»£ç è§£æå™¨æµ‹è¯•</h1>
    
    <div class="game-status">
        <h3>æ¸¸æˆçŠ¶æ€</h3>
        <div id="gameStatus">æ¸¸æˆæœªåˆå§‹åŒ–</div>
    </div>
    
    <div class="test-section">
        <h3>ä»£ç è¾“å…¥</h3>
        <textarea id="codeInput" placeholder="è¾“å…¥Pythonä»£ç ...">
# ç¤ºä¾‹ä»£ç 
wood + 100
stone + 50
build wall at (3, 4)
move colonist to (5, 5)
auto on</textarea>
        <br>
        <button onclick="runTest()">ğŸš€ æ‰§è¡Œä»£ç </button>
        <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
        <button onclick="loadExample()">ğŸ“ åŠ è½½ç¤ºä¾‹</button>
    </div>
    
    <div class="test-section">
        <h3>æ‰§è¡Œç»“æœ</h3>
        <div id="results"></div>
    </div>

    <script src="code_interpreter.js"></script>
    <script>
        // æ¨¡æ‹Ÿæ¸¸æˆå¯¹è±¡
        class MockGame {
            constructor() {
                this.resources = {wood: 100, stone: 50, food: 200, metal: 30};
                this.buildings = [];
                this.colonists = [{name: 'æµ‹è¯•æ®–æ°‘è€…', x: 2, y: 2, hp: 3, maxHp: 3, isDowned: false}];
                this.selectedColonist = this.colonists[0];
                this.autoMode = false;
                this.weather = 'sunny';
                this.temperature = 20;
                this.mapSize = 12;
                this.buildingTypes = {
                    wall: {cost: {wood: 2}, hp: 100},
                    house: {cost: {wood: 8, stone: 4}, hp: 150},
                    bed: {cost: {wood: 5}, hp: 50}
                };
            }

            updateUI() {
                this.displayGameStatus();
            }

            draw() {
                console.log('æ¸¸æˆé‡ç»˜');
            }

            displayGameStatus() {
                const status = document.getElementById('gameStatus');
                status.innerHTML = `
                    <strong>èµ„æº:</strong> æœ¨æ:${this.resources.wood}, çŸ³å¤´:${this.resources.stone}, é£Ÿç‰©:${this.resources.food}, é‡‘å±:${this.resources.metal}<br>
                    <strong>å»ºç­‘æ•°é‡:</strong> ${this.buildings.length}<br>
                    <strong>æ®–æ°‘è€…:</strong> ${this.colonists[0].name} (${this.colonists[0].x}, ${this.colonists[0].y}) HP:${this.colonists[0].hp}<br>
                    <strong>è‡ªåŠ¨æ¨¡å¼:</strong> ${this.autoMode ? 'å¼€å¯' : 'å…³é—­'}<br>
                    <strong>å¤©æ°”:</strong> ${this.weather}, æ¸©åº¦:${this.temperature}Â°C
                `;
            }

            startAutoTasks() {
                console.log('å¯åŠ¨è‡ªåŠ¨ä»»åŠ¡');
            }

            stopAutoTasks() {
                console.log('åœæ­¢è‡ªåŠ¨ä»»åŠ¡');
            }

            triggerDisaster(type) {
                console.log(`è§¦å‘ç¾å®³: ${type}`);
                // æ¨¡æ‹Ÿç¾å®³æ•ˆæœ
                if (type === 'flood' || type === 'æ´ªæ°´') {
                    this.resources.wood = Math.max(0, this.resources.wood - 20);
                } else if (type === 'earthquake' || type === 'åœ°éœ‡') {
                    this.resources.stone = Math.max(0, this.resources.stone - 15);
                }
                this.updateUI();
            }

            displayCodeResults(summary) {
                const resultsDiv = document.getElementById('results');
                let html = '<div class="code-execution-results">';
                html += `<h4>ğŸ”§ ä»£ç æ‰§è¡Œç»“æœ</h4>`;
                html += `<p>æ€»æ“ä½œæ•°: ${summary.totalActions}, æˆåŠŸ: ${summary.successfulActions}, å¤±è´¥: ${summary.failedActions}</p>`;
                
                if (summary.results.length > 0) {
                    html += '<div class="results-list">';
                    summary.results.forEach((result, index) => {
                        const status = result.success ? 'âœ…' : 'âŒ';
                        const className = result.success ? 'success' : 'error';
                        html += `<div class="result-item ${className}">`;
                        html += `<span class="status">${status}</span>`;
                        html += `<span class="action">${result.action || result.error}</span>`;
                        html += `<small class="code-line">${result.line}</small>`;
                        html += '</div>';
                    });
                    html += '</div>';
                }
                
                html += '</div>';
                resultsDiv.innerHTML = html;
            }

            executePythonCode(code) {
                if (!this.codeInterpreter) {
                    return {
                        success: false,
                        error: 'ä»£ç è§£æå™¨æœªåˆå§‹åŒ–'
                    };
                }

                try {
                    const results = this.codeInterpreter.interpretCode(code);
                    
                    const summary = {
                        success: true,
                        totalActions: results.length,
                        successfulActions: results.filter(r => r.success).length,
                        failedActions: results.filter(r => !r.success).length,
                        results: results
                    };

                    this.displayCodeResults(summary);
                    return summary;
                } catch (error) {
                    return {
                        success: false,
                        error: error.message
                    };
                }
            }
        }

        // åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
        let mockGame = new MockGame();
        mockGame.codeInterpreter = new CodeInterpreter(mockGame);
        mockGame.displayGameStatus();

        function runTest() {
            const code = document.getElementById('codeInput').value;
            if (!code.trim()) {
                document.getElementById('results').innerHTML = '<div class="error">è¯·è¾“å…¥ä»£ç </div>';
                return;
            }

            const result = mockGame.executePythonCode(code);
            console.log('æ‰§è¡Œç»“æœ:', result);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function loadExample() {
            const examples = [
                `# èµ„æºç®¡ç†ç¤ºä¾‹
wood + 100
stone + 50
food + 200`,
                `# å»ºç­‘ç¤ºä¾‹
build wall at (3, 4)
build house at (5, 6)
build bed at (7, 8)`,
                `# æ®–æ°‘è€…æ“ä½œç¤ºä¾‹
move colonist to (8, 9)
heal colonist
auto on`,
                `# ç¯å¢ƒæ§åˆ¶ç¤ºä¾‹
weather = "rainy"
temperature = 15
disaster flood`
            ];
            
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            document.getElementById('codeInput').value = randomExample;
        }
    </script>
</body>
</html>
